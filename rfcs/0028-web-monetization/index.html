<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The protocol for connecting blockchains and other ledgers">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Custom styles -->
    <link href="/assets/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700,900|Droid+Sans+Mono|Titillium+Web:400,300,600,900' rel='stylesheet' type='text/css'>

    <link href="/assets/favicon.png" rel="icon" type="image/x-icon">

    <!--  highlight js -->
    <link rel="stylesheet" href="/assets/css/monokai-sublime.css">

    <!-- fontawesome icons -->
    <link rel="stylesheet" href="/assets/fontawesome/css/font-awesome.min.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->




</head>

<body class="sidebar-primary ">

  <!-- <div class="container"> -->
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark nav-innerpage">
            <div class="navbar-leftbg"><a href="/" class="navbar-brand"><img src="/assets/img/ilp_logo@2x.png" class="logo"  height="44" alt="Interledger" /></a></div>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarHolder" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">

              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarHolder">
              <ul class="nav navbar-nav">
                    <li class="nav-item" ><a class="nav-link" href="/overview.html">Docs</a></li>
                    <li class="nav-item" ><a class="nav-link" href="/libraries.html">Tools</a></li>
                    <li class="nav-item" ><a class="nav-link" href="/community.html">Community</a></li>
                    <li class="nav-item"><a class="nav-link" target="_blank" href="https://github.com/interledger">Edit on Github</a></li>
                    <li class="nav-item"><a class="nav-link cornerlink" href="/getting-started.html">Get Started</a></li>
              </ul><!-- /.navbar-nav -->
              <div class="cornerbox"></div>
            </div>
            <div class="menu-overlay"></div>
        </nav>
    <!-- </div> -->

    <div class="container-fluid" role="document" id="main_content_wrapper">
        <div class="row">

        <aside class="sidebar col-md-4 col-lg-3 p-0 order-md-1" role="complementary">

    <div id="sidenav" class="tree_nav">
      <ul class=" sidebar_pagelist">
        <li class="nav-label">Quick Start</li>
        <li><a href="/overview.html">Overview</a></li>
        <li><a href="/getting-started.html">Getting Started</a></li>
            <ul>
                <li><a href="/sending-value-programmatically.html">Sending Value Programmatically</a></li>
                <li><a href="/connect-ilp-testnet.html">Connect to an ILP Testnet</a></li>
            </ul>
      </ul>
      <ul class=" sidebar_pagelist">
        <li class="nav-label">Community Resources</li>
        <li><a class="external-link" href="https://medium.com/interledger-blog">Blog and Tutorials<i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        <li><a href="/libraries.html">Libraries and Tools</a></li>
        <li><a href="/summit-2019.html">ILP Summit 2019 Videos</a></li>
      </ul>

      <div class="sidebar-nav-header">Specs</div>
      <ul class=" sidebar_pagelist sidebar_indent">
            <li><a href="/rfcs/0027-interledger-protocol-4/">Interledger Protocol 4 (ILPv4)</a></li>
            <li><a href="/rfcs/0015-ilp-addresses/">Interledger Addresses</a></li>
            <li><a href="/rfcs/0029-stream/">STREAM Protocol</a></li>
            <li><a href="/rfcs/0009-simple-payment-setup-protocol/">Simple Payment Setup Protocol (SPSP)</a></li>
            <li><a href="/rfcs/0030-notes-on-oer-encoding/">Notes on OER encoding</a></li>
            <li><a href="/rfcs/0031-dynamic-configuration-protocol/">Dynamic Configuration Protocol (ILDCP)</a></li>
            <li><a href="/rfcs/0032-peering-clearing-settlement/">Peering, Clearing and Settlement</a></li>
            <li><a href="/rfcs/0038-settlement-engines/">Settlement Engines</a></li>
            <li><a href="/rfcs/0035-ilp-over-http/">ILP over HTTP</a></li>
            <li><a href="/rfcs/0036-spsp-pull-payments/">SPSP Pull Payments</a></li>
            <li>&nbsp;</li>
            <li><a class="external-link" target="_blank" href="https://paymentpointers.org">Payment Pointers</a></li>
            <li><a class="external-link" target="_blank" href="https://webmonetization.org">Web Monetization</a></li>
            <li><a class="external-link" target="_blank" href="https://w3c.github.io/webpayments/proposals/interledger-payment-method.html">W3C Web Payments</a></li>
        </ul>
    </div>        </aside>

          <!-- main column -->
        <main class="main col-md-8  col-lg-6   order-md-3  " role="main" id="main_content_body">
  <article class="pt-3 p-md-3">
    <div class="content doc-content">
        <h1 id="web-monetization">Web Monetization</h1>
<p>Web Monetization is a proposed browser API that uses ILP micropayments to monetize a site. It can be provided through a polyfill or an extension, but the goal is to eventually implement it directly into the user's browser.</p>
<h2 id="overview">Overview</h2>
<h3 id="terminology">Terminology</h3>
<ul>
<li>The <strong>user</strong> is the party who is accessing the web-monetized site.</li>
<li>The <strong>provider</strong> is the party providing Interledger access to the user.</li>
<li>The <strong>browser</strong> is the web browser used by the user, which may include extensions that implement Web Monetization.</li>
</ul>
<h3 id="design-goals">Design Goals</h3>
<ul>
<li>Should be extremely simple for webmasters to use in their sites.</li>
<li>Back-end infrastructure should be optional, and should be usable on a static site.</li>
<li>Should not require any interaction with the user.</li>
<li>Should give the user's browser a choice about how much to spend, and which sites to support.</li>
<li>Should give advanced webmasters a way to associate payments with their users, in order to unlock premium experiences.</li>
<li>Should pay continuously as the user consumes content.</li>
<li>Should be compatible with existing application and transport protocols on Interledger.</li>
</ul>
<h3 id="relation-to-other-protocols">Relation to Other Protocols</h3>
<p>The W3C has published two payments-related APIs for browsers, the Payment Request API and the Payment Handler API.</p>
<p>The reason this Web Monetization API is not using the Payment Request API directly is that Web Monetization is intended for continuous payments rather than discrete payments. It is also not designed to have any user interaction. It is intended to provide a direct alternative to advertisements, rather than an alternative to existing checkout methods.</p>
<p>Some changes will be required to Payment Request and Payment Handler to fully support Web Monetization in the future, however this API brings the necessary features to the browser in a way that allows for tighter integration in the future.</p>
<p>With advertisements, the user's browser decides whether to display the ads and the user decides whether to engage with the ads. With Web Monetization, the user's provider decides whether to pay the site and, if so, how much to pay.</p>
<p>Web Monetization makes use of <a href="/rfcs/0009-simple-payment-setup-protocol/">SPSP</a> on top of <a href="/rfcs/0029-stream/">ILP/STREAM</a> to provide a high-level way to send money and data, while still providing tremendous flexibility.</p>
<h2 id="flow">Flow</h2>
<p>This flow refers to the user's <strong>browser</strong> and the user's <strong>provider</strong>, <a href="#terminology">defined above</a>.</p>
<ul>
<li>The user's browser navigates to a webpage.</li>
<li>The user's browser sets <code>document.monetization</code> to an Object which implements <a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget" target="_blank">EventTarget <i aria-hidden="true" class="fa fa-external-link"></i></a>.</li>
<li>The user's browser sets <code>document.monetization.state</code> to <code>pending</code>.</li>
<li>The user's browser observes the <code>&lt;head&gt;</code> and looks for a Web Monetization <code>&lt;meta name="monetization"&gt;</code> tag (<a href="#meta-tags-set">specified below</a>).</li>
<li>There MUST be only one <code>&lt;meta name="monetization"&gt;</code> tag at any given time.</li>
<li>The <code>&lt;meta&gt;</code> Tags Set MUST be in the <code>&lt;head&gt;</code> of the document.</li>
<li>
<p>The <code>&lt;meta&gt;</code> Tags Set MUST be in the top level window (i.e., not inside an iframe)</p>
</li>
<li>
<p>Below is repeated for every semantically (consider <code>meta.content = meta.content</code>) new  <code>&lt;meta name="monetization"&gt;</code> tag seen for the life of the page:</p>
</li>
<li>If any of the Web Monetization <code>&lt;meta&gt;</code> Tags Set are malformed, the browser will stop here. The user's browser SHOULD report a warning via the console.</li>
<li>If the Web Monetization <code>&lt;meta name="monetization"&gt;</code> tag is well-formed, the browser should extract the Payment Setup Endpoint (<a href="../0026-payment-pointers">Payment Pointer</a> or <a href="../0009-simple-payment-setup-protocol">SPSP</a> Url).</li>
<li>The user's browser generates a fresh <strong>random</strong> UUID (version 4) and uses this as a Monetization ID. This MUST be regenerated upon dynamic changes to the meta tags and MUST be unique per page load in order to avoid user tracking.</li>
<li>The user's browser passes these payment details to the user's provider (see <a href="#payment-handler-flow">Payment Handler Flow</a>).</li>
<li>The provider resolves the Payment Setup Endpoint and begins to pay. The provider MAY be acting from a different machine from the user. Cookies and session information MUST NOT be carried with any requests made to resolve the Payment Setup Endpoint, with the exception of the Monetization ID.<ul>
<li>On the SPSP query to resolve the Payment Setup Endpoint, a <code>Web-Monetization-Id</code> header is sent, containing the Monetization ID. The server running the web-monetized site may use this to associate future requests by the user with their payments.</li>
<li>With the <code>destination_account</code> and <code>shared_secret</code> fetched from the SPSP query, a STREAM connection is established. A single STREAM is opened on this connection, and a positive SendMax is set.</li>
<li>The provider SHOULD set their SendMax high enough that it is never reached, and make payment adjustments by limiting throughput.</li>
</ul>
</li>
<li>Once the STREAM connection has fulfilled an ILP packet with a non-zero amount, the provider notifies the browser:<ul>
<li>The user's browser sets <code>document.monetization.state</code> to <code>started</code>.</li>
<li>This MUST occur before the <code>monetizationstart</code> event is fired.</li>
<li>This event has a <code>detail</code> field with an object containing the Payment Setup Endpoint and the Monetization ID (<a href="#monetizationstart">specified below</a>).</li>
<li>The user's browser also emits a <code>monetizationprogress</code> (<a href="#monetizationprogress">specified below</a>) event from <code>document.monetization</code>, corresponding to this first packet. If there are no listeners the event MAY NOT be emitted.</li>
</ul>
</li>
<li>Payment continues for the lifetime of a given meta tag (or semantically equivalent)<ul>
<li>The provider MAY decide to stop/start payment at any time, such as if the user is idle, backgrounds the page, or instructs the browser to do so.</li>
<li>If the STREAM connection is severed, the provider will redo the SPSP query to the same Payment Setup Endpoint as before with the same Monetization ID. The user's browser MUST NOT re-process the <code>&lt;meta&gt;</code> Tags Set.</li>
<li>Each time a packet with a nonzero amount is fulfilled, the provider notifies the browser, and the browser emits an event on <code>document.monetization</code>. The event's type is <code>monetizationprogress</code>. The event has a <code>detail</code> field containing the details of the packet (<a href="#monetizationprogress">specified below</a>). If there are no listeners the event MAY NOT be emitted.</li>
<li>When a stream is closed, the <code>document.monetization.state</code> MUST be set back to 'pending'</li>
</ul>
</li>
</ul>
<h3 id="payment-handler-flow">Payment Handler Flow</h3>
<p>A provider can be implemented as a Payment Handler supporting the 'webmonetization' payment method (The payment method specification for this payment method is still under development.). Communication between the browser and the provider would use this flow.</p>
<ul>
<li>After parsing the <code>&lt;meta&gt;</code> Tags Set, the browser creates a new <a class="external-link" href="https://www.w3.org/TR/payment-request/#paymentrequest-interface" target="_blank">PaymentRequest <i aria-hidden="true" class="fa fa-external-link"></i></a> object with the following <a class="external-link" href="https://www.w3.org/TR/payment-request/#dom-paymentmethoddata" target="_blank">PaymentMethodData <i aria-hidden="true" class="fa fa-external-link"></i></a> argument.</li>
</ul>
<pre><code class="json">{
  "supportedMethods": "webmonetization",
  "data": {
    "paymentPointer": "{ payment pointer parsed from meta tag }"
  }
}
</code></pre>
<ul>
<li>The user's browser calls <code>.show()</code> on this PaymentRequest, triggering the <a class="external-link" href="https://www.w3.org/TR/payment-handler/" target="_blank">PaymentHandler <i aria-hidden="true" class="fa fa-external-link"></i></a> for <code>webmonetization</code>. This PaymentHandler is how the browser communicates to the provider.</li>
<li>The return value of <code>.show()</code> MUST return a Promise, and must also implement the <a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget" target="_blank">EventTarget <i aria-hidden="true" class="fa fa-external-link"></i></a> interface. The provider will emit <a href="#monetizationstart">MonetizationStart</a> and <a href="#monetizationprogress">MonetizationProgress</a> events from this Promise to communicate to the browser when payment occurs. The Promise MUST NOT resolve, because Web Monetization continues for the entire lifetime of a given meta tag. The Promise MAY reject if there is an error preventing the provider from paying and no retries will occur.</li>
<li>This PaymentHandler MUST NOT require any UI or confirmation to proceed with payment.</li>
</ul>
<h2 id="specification">Specification</h2>
<h3 id="meta-tags-set">Meta Tags Set</h3>
<p>The <code>&lt;meta&gt;</code> Tags Set MUST be in the document's <code>&lt;head&gt;</code>. The <code>&lt;meta&gt;</code> Tags Set allows the user's browser to pay a site via Web Monetization by specifying a <a href="/rfcs/0026-payment-pointers/">Payment Pointer</a> or <a href="../0009-simple-payment-setup-protocol">SPSP</a> url.</p>
<p>The <code>name</code> of the <code>&lt;meta&gt;</code> tags all start with <code>monetization</code>. The table below lists the different <code>name</code> values and the formats of their <code>content</code>. Currently there is only one tag, but this may be expanded in the future so care MUST be given to altering a Tags Set such that <code>&lt;meta name="monetization"&gt;</code> is the last one modified.   </p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Required?</th>
<th align="left">Format</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>monetization</code></td>
<td align="left">Yes</td>
<td align="left">Payment Setup Endpoint</td>
<td align="left">The <a href="(../0026-payment-pointers/0026-payment-pointers.md)">Payment Pointer</a> or SPSP url that the user's browser will pay to.</td>
</tr>
</tbody>
</table>
<h4 id="examples">Examples</h4>
<h5 id="web-monetization-meta-tag">Web Monetization Meta Tag</h5>
<pre><code class="html">&lt;meta
  name="monetization"
  content="$twitter.xrptipbot.com/Interledger"&gt;
</code></pre>
<h3 id="javascript-api">Javascript API</h3>
<pre><code class="ts">document.monetization: EventTarget
document.monetization.state: string
</code></pre>
<p><code>document.monetization.state</code> can be one of two values.</p>
<ul>
<li><code>pending</code> - Indicates that monetization has not yet started. This is set even if there are no Web Monetization <code>&lt;meta&gt;</code> tags on the page.</li>
<li><code>started</code> - Indicates that monetization has started (i.e. the <code>monetizationstart</code> event has been fired).</li>
</ul>
<h3 id="browser-events">Browser Events</h3>
<p>These events are dispatched on <code>document.monetization</code>. Web Monetization events MAY be implemented as <a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent" target="_blank"><code>CustomEvent</code> <i aria-hidden="true" class="fa fa-external-link"></i></a>s, or as their own Event class.</p>
<h4 id="monetizationstart"><code>monetizationstart</code></h4>
<p>Dispatched once the first ILP packet with a non-zero amount has been fulfilled by the page's SPSP receiver. MUST be dispatched at least once if payment occurs.</p>
<pre><code class="ts">{
  detail: {
    // Payment Setup Endpoint
    paymentPointer: string,
    // Monetization ID / Web-Monetization-Id header
    requestId: string
  }
}
</code></pre>
<p>The <code>paymentPointer</code> matches the one in the <code>&lt;meta name="monetization"&gt;</code> tag. The <code>requestId</code> matches the Monetization ID (UUID V4) generated by the browser (see <a href="#flow">Flow</a>).</p>
<h4 id="monetizationprogress"><code>monetizationprogress</code></h4>
<p>Dispatched every time an ILP packet with a non-zero amount has been fulfilled by the page's SPSP receiver (including the first time, when <code>monetizationstart</code> is also dispatched). This event MAY NOT be emitted if there are no listeners for it on <code>document.monetization</code>.</p>
<pre><code class="ts">{
  detail: {
    // Received amount
    amount: string,
    assetCode: string,
    assetScale: number
  }
}
</code></pre>
<ul>
<li><code>amount</code> is a String containing the destination amount <strong>received</strong> as specified in the ILP packet.</li>
<li><code>assetCode</code> contains the three letter asset code describing the amount's units.</li>
<li><code>assetScale</code> contains a number representing the scale of the amount. For example, cents would have an assetScale of <code>2</code>.</li>
</ul>
<h3 id="http-headers">HTTP Headers</h3>
<h4 id="web-monetization-id"><code>Web-Monetization-Id</code></h4>
<p>Contains the <code>Monetization ID</code> (currently referred to as <code>requestId</code> in the events) that the browser generated. This header MUST always be sent on SPSP queries for Web Monetization. This value MUST be a UUID version 4.</p>
<pre><code class="http">Web-Monetization-Id: dcd479ad-7d8d-4210-956a-13c14b8c67eb
</code></pre>
    </div>
  </article>
        </main>

        <aside class="right-sidebar col-lg-3 order-lg-4 p-0" role="complementary">
  <div class="card" id="page-toc-wrapper">
    <div class="card-header">
      <h4>On This Page</h4>
    </div>
    <ul class="card-body">
      <li class="level-1"><a href="#web-monetization">Web Monetization</a></li>
<li class="level-2"><a href="#overview">Overview</a></li>
<li class="level-3"><a href="#terminology">Terminology</a></li>
<li class="level-3"><a href="#design-goals">Design Goals</a></li>
<li class="level-3"><a href="#relation-to-other-protocols">Relation to Other Protocols</a></li>
<li class="level-2"><a href="#flow">Flow</a></li>
<li class="level-3"><a href="#payment-handler-flow">Payment Handler Flow</a></li>
<li class="level-2"><a href="#specification">Specification</a></li>
<li class="level-3"><a href="#meta-tags-set">Meta Tags Set</a></li>
<li class="level-3"><a href="#javascript-api">Javascript API</a></li>
<li class="level-3"><a href="#browser-events">Browser Events</a></li>
<li class="level-3"><a href="#http-headers">HTTP Headers</a></li>

    </ul>
  </div>
        </aside>

        </div><!--/.row (main layout)-->
      </div>


<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="col-sm-9 col-xs-12 float-left footertext">
                    <p><img src="/assets/img/ilp_footer_logo@2x.png" height="44" alt="Interledger" align="left" /> Interledger Project<br><span>Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a></span></p>
                </div>
                <div class="col-sm-3 col-xs-12 float-right">
                    <a href="https://twitter.com/interledger"><img src="/assets/img/Twitter.png"></a>
                    <a href="https://communityinviter.com/apps/interledger/interledger-working-groups-slack"><img src="/assets/img/Slack.png"></a>
                </div>
            </div>
        </div>
    </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/highlight.pack.js"></script>
<script src="/assets/js/custom.js"></script>
<!-- <script src="/assets/js/home.js"></script> -->
<!-- <script type="text/javascript" src="/assets/js/svg-animation.js"></script> -->

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68500608-1', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>