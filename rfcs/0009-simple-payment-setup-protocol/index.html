<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <base href="https://jakeatdocforce.github.io/interledger-dactyl/"> -->
    <!-- <base href="http://localhost:8000/"> -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The protocol for connecting blockchains and other ledgers">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Custom styles -->
    <link href="/assets/css/custom.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,600,700|Droid+Sans+Mono|Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>

    <link href="/assets/favicon.png" rel="icon" type="image/x-icon">

    <!--  highlight js -->
    <link rel="stylesheet" href="/assets/css/monokai-sublime.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->




</head>

<body class="xrp-ledger-dev-portal sidebar-primary ">

  <div class="container">
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark nav-innerpage">
            <div class="navbar-leftbg"><a href="/index.html" class="navbar-brand"><img src="/assets/img/ilp_logo.png" class="logo"  height="44" alt="Interledger" /></a></div>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarHolder" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <!-- <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> -->

              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarHolder">
              <ul class="nav navbar-nav">
                    <li class="nav-item" ><a class="nav-link" href="/overview.html">Docs</a></li>
                    <li class="nav-item" ><a class="nav-link" href="/libraries.html">Tools</a></li>
                    <li class="nav-item" ><a class="nav-link" href="/community.html">Community</a></li>
                    <li class="nav-item"><a class="nav-link" target="_blank" href="https://github.com/interledger">Edit on Github</a></li>
                    <li class="nav-item"><a class="nav-link cornerlink" href="/getting-started.html">Get Started</a></li>
              </ul><!-- /.navbar-nav -->
              <div class="cornerbox"></div>
            </div>
            <div class="menu-overlay"></div>
        </nav>
    </div>

    <div class="container-fluid" role="document" id="main_content_wrapper">
        <div class="row">

        <aside class="sidebar col-md-5 col-lg-3 p-0 order-md-1" role="complementary">

    <div id="sidenav" class="tree_nav">
      <ul class=" sidebar_pagelist">
        <li class="nav-label">Quick Start</li>
        <li><a href="/overview.html">Overview</a></li>
        <li><a href="/getting-started.html">Getting Started</a></li>
      </ul>
      <ul class=" sidebar_pagelist">
        <li class="nav-label">Community Resources</li>
        <li><a href="https://medium.com/interledger-blog">Blog &amp; Tutorials</a></li>
        <li><a href="/libraries.html">Libraries &amp; Tools</a></li>
        <li><a href="/summit-2019.html">ILP Summit 2019 Videos</a></li>
      </ul>

      <div class="sidebar-nav-header">Specs</div>
      <ul class=" sidebar_pagelist sidebar_indent">
        <!--    <li><a href="/rfcs/0001-interledger-architecture/">Interledger Architecture</a></li> -->
        <li><a href="/rfcs/0027-interledger-protocol-4/">Interledger Protocol 4 (ILPv4)</a></li>
        <li><a href="/rfcs/0015-ilp-addresses/">Interledger Addresses</a></li>
        <li><a href="/rfcs/0029-stream/">STREAM Protocol</a></li>
        <li><a href="/rfcs/0009-simple-payment-setup-protocol/">Simple Payment Setup Protocol (SPSP)</a></li>
        <li><a href="/rfcs/0026-payment-pointers/">Payment Pointers</a></li>
        <li><a href="/rfcs/0028-web-monetization/">Web Monetization</a></li>
        <li><a href="/rfcs/0030-notes-on-oer-encoding/">Notes on OER encoding</a></li>
        <li><a href="/rfcs/0031-dynamic-configuration-protocol/">Dynamic Configuration Protocol (ILDCP)</a></li>
        <li><a href="/rfcs/0032-peering-clearing-settlement/">Peering, Clearing and Settlement</a></li>
        <li><a href="/rfcs/0035-ilp-over-http/">ILP over HTTP</a></li>
        <li><a href="/rfcs/0036-spsp-pull-payments/">SPSP Pull Payments</a></li>
        <li><a target="_blank" href="https://w3c.github.io/webpayments/proposals/interledger-payment-method.html">W3C Web Payments</a></li>

      </ul>
    </div>        </aside>

          <!-- main column -->
        <main class="main col-md-7 col-lg-6 order-md-3  " role="main" id="main_content_body">
  <article class="pt-3 p-md-3">
    <div class="content doc-content">
        <h1 id="simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</h1>
<h2 id="preface">Preface</h2>
<p>This document describes the Simple Payment Setup Protocol (SPSP), a basic protocol for exchanging payment information between payee and payer to facilitate payment over Interledger. SPSP uses the <a href="/rfcs/0029-stream/">STREAM</a> transport protocol for condition generation and data encoding.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="motivation">Motivation</h3>
<p>STREAM does not specify how payment details, such as the ILP address or shared secret, should be exchanged between the counterparties. SPSP is a minimal protocol that uses HTTPS for communicating these details.</p>
<h3 id="scope">Scope</h3>
<p>SPSP provides for exchanging basic server details needed by a client to set up a STREAM connection. It is intended for use by end-user applications.</p>
<h3 id="definitions">Definitions</h3>
<ul>
<li><strong>SPSP Client</strong> - The application that uses SPSP to interact with the SPSP Server.</li>
<li><strong>SPSP Server</strong> - The application that handles incoming SPSP requests from the SPSP Client.</li>
<li><strong>SPSP Endpoint</strong> - The specific HTTPS endpoint on the SPSP Server used for setting up a payment.</li>
<li><strong>STREAM Module</strong> - Software included in the SPSP Client and Server that implements the <a href="/rfcs/0029-stream/">STREAM</a> protocol.</li>
</ul>
<h3 id="interfaces">Interfaces</h3>
<p>SPSP may be used by end-user applications, such as a digital wallet with a user interface to initiate payments. SPSP Clients and Servers use the STREAM Module to send and receive Interledger payments. <a href="/rfcs/0026-payment-pointers/">Payment pointers</a> can be used as a persistent identifier on Interledger. Payment pointers can also be used as a unique identifier for an invoice to be paid or for a pull payment agreement. </p>
<p>SPSP messages MUST be exchanged over HTTPS.</p>
<h3 id="operation">Operation</h3>
<p>Any SPSP Server will expose an HTTPS endpoint called the SPSP Endpoint. The SPSP Client can query this endpoint to get information about the SPSP Server's connection details, namely the ILP address and a shared secret. The SPSP Client can apply this information to establish a STREAM connection using the STREAM Module.</p>
<h3 id="relation-to-other-protocols">Relation to Other Protocols</h3>
<p>SPSP is used for exchanging connection information before an ILP payment or data transfer is initiated. The SPSP Client and Server use the <a href="/rfcs/0029-stream/">STREAM</a> transport protocol to generate the ILP packets. The SPSP Server generates the shared secret and ILP address to be used in STREAM and communicates it to the client over HTTPS.</p>
<h2 id="specification">Specification</h2>
<p>The SPSP Endpoint is a URL the payment pointer resolves to, used by the SPSP Client to query information about the SPSP Server and set up payments. SPSP Clients SHOULD treat the URL as opaque and not depend on any information they derive from the URL. There are several supported ways to refer to an SPSP Endpoint:</p>
<ul>
<li><a href="/rfcs/0026-payment-pointers/">Payment pointer</a> (Recommended) <code>$alice.example.com</code> or <code>$example.com/bob</code>. This SHOULD be the only kind of SPSP identifier exposed to users.</li>
<li>Raw endpoint URL (Not recommended) <code>https://example.com/spsp/alice</code>. This SHOULD NOT be exposed to users, but SHOULD be supported by SPSP Clients.</li>
</ul>
<p>The SPSP Endpoint MUST respond to HTTPS <code>GET</code> requests in the following manner:</p>
<h3 id="query-get-ltspsp-endpointgt">Query (<code>GET &lt;SPSP Endpoint&gt;</code>)</h3>
<p>The client queries the SPSP Endpoint to get information about the server:</p>
<h4 id="request">Request</h4>
<p>(With the identifier <code>$example.com</code>)</p>
<pre><code class="http">GET /.well-known/pay HTTP/1.1
Host: example.com
Accept: application/spsp4+json, application/spsp+json
</code></pre>
<h4 id="response">Response</h4>
<pre><code class="http">HTTP/1.1 200 OK
Content-Type: application/spsp4+json

{
  "destination_account": "example.ilpdemo.red.bob",
  "shared_secret": "6jR5iNIVRvqeasJeCty6C+YB5X9FhSOUPCL/5nha5Vs="
}
</code></pre>
<p>More information about the parameters can be found in section <a href="#response-body">Response Body</a>.</p>
<h5 id="response-headers">Response Headers</h5>
<p>The response MUST contain at least the following headers:</p>
<table>
<thead>
<tr>
<th align="left">Header</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>Content-Type</code></td>
<td align="left">MUST be <code>application/spsp4+json</code> to indicates the response is encoded as <a href="http://www.json.org/">JSON</a> and that the ILP payment should be sent via STREAM.</td>
</tr>
<tr>
<td align="left"><code>Cache-Control</code></td>
<td align="left">Indicates how long the SPSP Client should cache the response. See supported cache-control directives below.</td>
</tr>
</tbody>
</table>
<p>To handle as many transactions per second as possible, the SPSP Client caches results from the SPSP Server. The information returned by the SPSP Server is not expected to change rapidly, so repeated requests for the same information are usually redundant. The SPSP Server communicates how long to cache results for using the HTTP-standard <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control"><code>Cache-Control</code> header</a> in the responses to RESTful API calls.</p>
<p>The SPSP Client understands the following Cache-Control directives:</p>
<table>
<thead>
<tr>
<th align="left">Directive</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>max-age=&lt;i&gt;</code></td>
<td align="left">The SPSP Client should cache this response for <code>&lt;i&gt;</code> seconds. <code>&lt;i&gt;</code> MUST be a positive integer.</td>
</tr>
<tr>
<td align="left"><code>no-cache</code></td>
<td align="left">The SPSP Client must not cache this response.</td>
</tr>
</tbody>
</table>
<h5 id="response-body">Response Body</h5>
<p>The response body is a JSON object that includes basic account details necessary for setting up payments. More fields can be added but implementations MUST ignore fields they do not understand. </p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>destination_account</code></td>
<td><a href="/rfcs/0015-ilp-addresses/">ILP Address</a></td>
<td>ILP Address of the SPSP Server. In case of push payments, this is the receiver. In case of pull payments, this is the sender.</td>
</tr>
<tr>
<td><code>shared_secret</code></td>
<td>32 bytes, <a href="https://en.wikipedia.org/wiki/Base64">base64 (base64url) encoded</a> (including padding)</td>
<td>The shared secret to be used by this specific HTTP client in the <a href="/rfcs/0029-stream/">STREAM</a>. Should be shared only by the server and this specific HTTP client, and should therefore be different in each query response. Even though clients SHOULD accept base64url encoded secrets, base64 encoded secrets are recommended.</td>
</tr>
</tbody>
</table>
<h5 id="errors">Errors</h5>
<h6 id="receiver-does-not-exist">receiver Does Not Exist</h6>
<pre><code class="http">HTTP/1.1 404 Not Found
Content-Type: application/spsp4+json

{
  "id": "InvalidReceiverError",
  "message": "Invalid receiver ID"
}
</code></pre>
<h2 id="model-of-operation">Model of Operation</h2>
<h3 id="establishing-a-connection">Establishing a connection</h3>
<p>We assume that the SPSP Client knows the SPSP Server's SPSP Endpoint (see <a href="/rfcs/0026-payment-pointers/">Payment pointers</a>).</p>
<ol>
<li>
<p>The user's SPSP Client queries the SPSP Server's SPSP Endpoint.</p>
</li>
<li>
<p>The SPSP Endpoint responds with the SPSP Server's info, namely the ILP address (<code>destination_account</code>) and the shared secret (<code>shared_secret</code>) to be used in STREAM. </p>
<ul>
<li>The <code>destination_account</code> MUST be used as the STREAM <code>destinationAccount</code>.</li>
<li>The <code>shared_secret</code> MUST be decoded from base64 and used as the STREAM <code>sharedSecret</code>.</li>
</ul>
<p>It MAY respond with additional information if it is an invoice server or a pull payment server. For more information, see <a href="/rfcs/0037-spsp-invoices/">SPSP Invoices</a> and <a href="/rfcs/0036-spsp-pull-payments/">SPSP Pull Payments</a>.</p>
</li>
<li>
<p>The SPSP Client establishes a STREAM connection to the SPSP Server using the SPSP Server's ILP address and shared secret.</p>
</li>
</ol>
<h3 id="examples">Examples</h3>
<h4 id="simple-push-payment">Simple push payment</h4>
<p>Given the open STREAM connection, the SPSP Client begins sending ILP packets of value.
  1. The SPSP Client will adjust their STREAM <code>sendMax</code> to reflect the amount they're willing to send.
  2. The SPSP Server will adjust their STREAM <code>receiveMax</code> to reflect the amount they're willing to receive.
  3. The SPSP Client's and Server's STREAM Modules will move as much value as possible while staying inside these bounds.
  4. If the SPSP Client reaches their <code>sendMax</code>, they end the stream and the connection. If the SPSP Server reaches their <code>receiveMax</code>, they will end the stream and the connection.</p>
<h4 id="simple-data-transmission">Simple data transmission</h4>
<p>Given the open STREAM connection, either the SPSP Client or the Server begins sending ILP packets of data.</p>
<p>The size of the data SHOULD be defined setting STREAM <code>maxOffset</code>. Each application built on STREAM and using the principle of data transmission MAY define more restrictive requirements. </p>
<hr/>
<p>All STREAM parameters - <code>destinationAccount</code>, <code>sharedSecret</code>, <code>sendMax</code>, <code>receiveMax</code>, <code>maxOffset</code> - are defined in <a href="/rfcs/0029-stream/#53-frames">STREAM's frame encoding</a>.</p>
<p>Note that the SPSP Client and Server can send as many STREAM payments and data as they want using the same query response. If the STREAM connection is closed the Client SHOULD attempt to reconnect with the same parameters or it SHOULD query the Server again for new connection parameters once the time indicated in the <a href="#response-headers"><code>Cache-Control</code> header</a> has passed.</p>
    </div>
  </article>
        </main>

        <aside class="right-sidebar col-lg-3 order-lg-4 p-0" role="complementary">
  <div class="card" id="page-toc-wrapper">
    <div class="card-header">
      <h4>On This Page</h4>
    </div>
    <ul class="card-body">
      <li class="level-1"><a href="#simple-payment-setup-protocol-spsp">Simple Payment Setup Protocol (SPSP)</a></li>
<li class="level-2"><a href="#preface">Preface</a></li>
<li class="level-2"><a href="#introduction">Introduction</a></li>
<li class="level-3"><a href="#motivation">Motivation</a></li>
<li class="level-3"><a href="#scope">Scope</a></li>
<li class="level-3"><a href="#definitions">Definitions</a></li>
<li class="level-3"><a href="#interfaces">Interfaces</a></li>
<li class="level-3"><a href="#operation">Operation</a></li>
<li class="level-3"><a href="#relation-to-other-protocols">Relation to Other Protocols</a></li>
<li class="level-2"><a href="#specification">Specification</a></li>
<li class="level-3"><a href="#query-get-ltspsp-endpointgt">Query ( GET &lt;SPSP Endpoint&gt; )</a></li>
<li class="level-2"><a href="#model-of-operation">Model of Operation</a></li>
<li class="level-3"><a href="#establishing-a-connection">Establishing a connection</a></li>
<li class="level-3"><a href="#examples">Examples</a></li>

    </ul>
  </div>
        </aside>

        </div><!--/.row (main layout)-->
      </div>


<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="col-sm-10 col-xs-12 float-left">
                    <img src="/assets/img/footerlogo.png">
                </div>
                <div class="col-sm-2 col-xs-12 float-right">
                    <a href="https://twitter.com/interledger"><img src="/assets/img/Twitter.png"></a>
                    <a href="https://communityinviter.com/apps/interledger/interledger-working-groups-slack"><img src="/assets/img/Slack.png"></a>
                </div>
            </div>
        </div>
    </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/custom.js"></script>
<script src="/assets/js/highlight.pack.js"></script>
<script src="/assets/js/home.js"></script>
<script type="text/javascript" src="/assets/js/svg-animation.js"></script>

<!-- <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68500608-1', 'auto');
    ga('send', 'pageview');

</script> -->

</body>
</html>